<!doctype html>
<html>
  <head>
    <title>Groger Score Calculator</title>
    <style>
      * {
	  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
      }
      button {
	  border: 1px solid #aaa;
	  border-radius: 4px;
      }
      button:hover {
	  background-color: #007bff;
      }
    </style>
    <script>
      function round (x) {
	  x = String(x);
	  if (x.indexOf('.') !== -1) {
	      split = x.split('.');
              roundedDecimal = split[1].substring(0, 2);
              x = split[0] + '.' + roundedDecimal;
	  }
	  return x;
      }
      function customAdjusts () {
	  if (document.getElementById('set').value === 'custom' && document.getElementById('pg-adjust') == null) {
	      document.getElementById('inputs').insertAdjacentHTML('beforeend', '<input id="pg-adjust" placeholder="Powers Adjustment"> <input id="ppb-adjust" placeholder="PPB Adjustment">');
	  }
      }
      function compute () {
	  var sets = {
              'is-186': [0, 0],
              'is-188': [-0.141, -0.65],
	      'is-190': [-0.126, -0.02],
	      'is-192': [-0.005, -0.69],
              'ssnct': [0.025, 0.32],
	      'raft': [-0.027, 0.11],
	      'shit': [0.508, 3.98],
	      'scottie': [0.116, 0.11],
	      'logic': [-0.030, -0.59],
	      'blast': [0.176, 3.38],
	      'wait': [-0.125, 0.23],
	      'hft': [0.063, 1.23],
	      'calisto': [0.001, 0.07],
	      'bhsat': [0.120, 0.49],
	      'eft': [0.709, 7.68],
	      'pb': [0.907, 9.58],
	      'mwt': [0.635, 7.31],
              'none': [0, 0],
	      'custom': [0, 0]
	  }
	  var outputs = document.getElementById('outputs');
	  while (outputs.hasChildNodes()) {
	      outputs.removeChild(outputs.lastChild);
	  }
	  try {
	      var g = Number(document.getElementById('games').value);
	      var pg = Number(document.getElementById('powers').value)/g;
	      var ppb = Number(document.getElementById('ppb').value);
	      var ng = Number(document.getElementById('negs').value)/g;
	      var set = document.getElementById('set').value;
	      var pga, ppba;
	      if (set === 'custom') {
		  pga = Number(document.getElementById('pg-adjust').value);
		  ppba = Number(document.getElementById('ppb-adjust').value);
	      } else {
		  pga = sets[set][0];
		  ppba = sets[set][1];
	      }
	      var apg = Math.pow(Math.cbrt(pg) + pga, 3);
	      var appb = ppb + ppba;
	      var score = 3.125*(apg + appb) - ng;
	      if (score != score) {
		  throw new Error('score is NaN');
	      }
	      outputs.innerHTML = '<p>Your adjusted powers per game [aP/G] is <strong>' + round(apg) + '</strong></p>\n' + 
		  '<p>Your adjusted points per bonus [aPPB] is <strong>' + round(appb) + '</strong></p>\n' +
		  // '<p>Your overall Groger Score is <strong>not good enough</strong></p>\n' + 
		  // '<p>lmao jk it\'s ' + round(score) + '</p>'
		  '<p>Your overall Groger Score is <strong>' + round(score) + '</strong>.</p>';
	  } catch (e) {
	      console.error(e);
	      outputs.innerHTML = '<p>Something seems to have broken; did you forget an input?</p>'
	  }
      }
    </script>
  </head>
  <body>
    <h1>Groger Score Calculator</h1>
    <p>These adjustments were last updated on <span text-decoration="underline">February 26th, 2020</span>.</p>
    <div id="inputs">
      <input id="powers" placeholder="Total Powers"> <input id="ppb" placeholder="PPB"> <input id="negs" placeholder="Total Negs"> <input id="games" placeholder="Games Played"> <select id="set" onchange="customAdjusts()">
	<option value="set">Choose a Set</option>
	<option value="is-186">IS-186</option>
	<option value="is-188">IS-188</option>
	<option value="is-190">IS-190</option>
	<option value="is-192">IS-192</option>
	<option value="ssnct">SSNCT-19</option>
	<option value="raft">RAFT</option>
	<option value="shit">Prison Bowl XII</option>
	<option value="scottie">Scottie</option>
	<option value="logic">LOGIC</option>
	<option value="blast">BLAST</option>
	<option value="wait">WAIT</option>
	<option value="hft">HFT</option>
	<option value="calisto">CALISTO</option>
	<option value="bhsat">BHSAT</option>
	<option value="eft">EFT</option>
	<option value="pb">Penn Bowl</option>
	<option value="mwt">MWT</option>
	<option value="none">Unadjusted</option>
	<option value="custom">Custom...</option>
      </select> <button id="compute" onclick="compute()">Compute Score</button>
    </div>
    <br>
    <div id="outputs"></div>
  </body>
</html>
